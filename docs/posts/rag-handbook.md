---
title: "RAG 手册"
date: 2025-01-05
tags: [RAG, Retrieval, Evaluation]
---

# RAG 手册

## 设计框架
1. 数据 → 清洗、拆分、元数据（source、time、owner）。
2. 索引 → 向量模型、倒排索引、多路召回。
3. 检索 → 召回、过滤、重排序、压缩。
4. 生成 → 模型回答，引用来源，控制长度。

## 分块与索引
- 分块尺寸：参考 256~512 tokens；按段落或标题切分。
- 嵌入：中英混合建议多语言模型；对表格可加结构化文本。
- 元数据：来源 URL、时间戳、作者、类别；用于过滤和重排。

## 检索策略
- 多路召回：向量 + BM25；必要时加关键字段过滤。
- 重排序：使用 cross-encoder / reranker；或用 LLM 做评分。
- 压缩：摘要 top-k，减少传入生成模型的长度。

## 质量评估
- 覆盖率 (Recall)：是否包含正确片段。
- 相关性 (NDCG/MRR)：排序是否合理。
- 真实性：答案是否基于引用；引用率、幻觉率。
- 成本/延迟：嵌入、检索、生成各阶段的耗时与费用。

## 常见问题
- 知识过期：在索引中加入时间；检索时优先新数据。
- 领域专有名词：自定义分词词表或添加术语词典。
- 空返回：明确告知用户“暂无相关信息”，不要硬编。
