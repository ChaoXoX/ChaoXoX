---
title: "知识库构建"
date: 2025-01-05
tags: [Knowledge Base, RAG, Data Engineering]
---

# 知识库构建

构建高质量的知识库是 RAG 系统成功的基石。不仅仅是把文档扔进向量数据库，更需要精细的数据工程。

## 1. 数据源治理
- **非结构化数据**：PDF、Word、Markdown。需要清洗页眉页脚、解析表格与图片（OCR/多模态模型）。
- **半结构化数据**：HTML、XML。保留层级结构，利用标签作为元数据。
- **结构化数据**：SQL、Excel。通常转化为自然语言描述或 CSV 文本，或通过 Text-to-SQL 利用。

## 2. 分块策略 (Chunking)
- **固定大小分块**：简单粗暴，如每 500 tokens 切分，重叠 50 tokens。容易切断语义。
- **语义分块**：基于 NLP 句法分析或模型判断，在话题转换处切分。
- **层级索引 (Parent-Child)**：
    - **小块**：用于向量检索，精准匹配。
    - **大块 (Parent)**：检索到小块后，返回其所属的父文档块给 LLM，提供完整上下文。

## 3. 知识增强
- **元数据提取**：自动提取时间、作者、摘要、关键词，存入向量库的 metadata 字段，用于过滤 (Pre-filtering)。
- **QA 对生成**：利用 LLM 预先根据文档生成 "问题-答案" 对。检索时匹配问题，效果往往优于匹配原始文档。
- **知识图谱 (Knowledge Graph)**：提取实体与关系，构建 GraphRAG。适用于需要多跳推理 (Multi-hop reasoning) 的场景。

## 4. 向量化与存储
- **Embedding 模型选择**：
    - 通用：OpenAI text-embedding-3, BGE-M3 (支持多语言、长文本)。
    - 垂直领域：建议在特定领域语料上微调 Embedding 模型。
- **向量数据库**：
    - Milvus, Qdrant, Weaviate, Pinecone。
    - 关注点：混合检索 (Hybrid Search) 支持、元数据过滤性能、分布式扩展能力。

## 5. 维护与更新
- **增量更新**：通过文件 Hash 或最后修改时间，只处理变更文件。
- **版本控制**：保留文档的历史版本，支持回溯。
- **过期淘汰**：设置 TTL 或定期归档旧知识，防止过时信息干扰。
